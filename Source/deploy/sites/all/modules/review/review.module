<?php
/**
 * Implements hook_menu().
 */
function review_menu() {
  $items['admin/config/development/review'] = array(
    'title' => 'Site Review Configuration',
    'description' => 'Configuration options for Site Review content.',
    'type' => MENU_NORMAL_ITEM,
    'page callback' => 'drupal_get_form',
    'page arguments' => array('review_configuration_form'),
    'access arguments' => array('administer hcp review configuration'),
    'file' => 'review_admin.inc',
  );

  $items['admin/config/development/review/setup'] = array(
    'title' => 'Site Review Configuration',
    'description' => 'Configuration options for Site Review content.',
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'page callback' => 'drupal_get_form',
    'page arguments' => array('review_configuration_form'),
    'access arguments' => array('administer hcp review configuration'),
    'file' => 'review_admin.inc',
  );
  
  return $items;
}



/**
 * Implements hook_block_info().
 */
function review_block_info() {
  $blocks = array();
  $blocks['review_select_form'] =  array(
    'info' => t('My site review'),
    'page callback' => 'my_site_review',
    'access argument' => array('access content'),
    );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function review_block_view($delta = '') {
  // This example is adapted from node.module.
  $block = array();
  

  switch ($delta) {
    case 'review_select_form':
      $block['subject'] = t('Review');
      $block['content'] = drupal_get_form('review_form');
    break;
  }
  return $block;
}

/**
 * Custom form.
 */
function review_form($form, &$form_state) {
  $form['experience'] = array(
    '#type' => 'radios',
    '#title' => t('Share your experience'),
    '#options' => array(
         'Good'=>'Good',
         'Average'=>'Average',
         'Bad'=>'Bad'),
         );
         
  $form['reason'] = array(
    '#type' => 'checkboxes',
    '#title' => t('Reason'),
    '#options' => array(
           'Content' =>'Content',
           'Performance' => 'Performance',
           'UI'=>'UI',
            ),
    '#states' => array(
            'visible' => array(
            ':input[name="experience"]' => array('value' => 'Bad'),
            //':input[name="experience"]' => array('value' => 3),
            ),
            ),
            );
   $form['comments'] = array(
    '#type' => 'textfield',
    '#title' => t('Comments'),
    '#description' => 'Please write any comments',
    '#size' => 50,
    '#maxlength' => 50,
    '#required' => TRUE,
    );
  

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => t('Submit Button'),
  );

  return $form;
}

/**
 * Custom form submit function.
 */
/*function review_form_submit($form, &$form_state) {

 echo "<strong>User experience:</strong> ". $form_state[values][experience].'<br><br>';
 
 if($form_state[values][experience] == 'Bad'){
 echo "<strong>REASON:</strong> ";
 foreach($form_state[values][reason] as $k=>$v){
 if ($v != '0'){
  echo $v.'<br>';
 }
} 
}

 echo "<strong>Comment submitted by User:</strong> ". $form_state[values][comments].'<br>';
 
echo '<br><br><br>';
  echo '<pre>';
  print_r($form_state);
  echo '</pre>';
  die;
   
  
  
}*/

/**
 * Implements security_settings_form_submit().
 */
function review_form_submit($form, $form_state) {
  global $user; 
  // Here u can insert Your custom form values into your custom table.
  db_insert('hcp_review')
    ->fields(array(
      'id' => 1,
      'uid' => $user->uid,
      'experience' => $form_state['values']['experience'],
      'reason' => $form_state['values']['reason'],
      'comments' => $form_state['values']['comments'],
    ))->execute();
    drupal_set_message("successfully saved"); 
}

 /**
 *Magnific Popup core JS file
 */

//drupal_add_js(drupal_get_path('module', 'review') . '/review.js');

/**
 * Submit handler for review configuration.
 *
 *
 * @ingroup form.
 */
function review_configuration_form_submit($form, &$form_state) {
  form_state_values_clean($form_state);
  $values = $form_state['values'];

  /*foreach ($values as $variable_name => $value) {
    // If the variable is an image then we need to convert to use uuid.
    if (in_array($variable_name, $images)) {
      if ($file_object = file_load($value)) {
        if (property_exists($file_object, 'uuid')) {
          $value = $file_object->uuid;
        }
      }
    }*/

    //variable_set($variable_name, $value);

  drupal_set_message(t('The configuration has been successfully saved.'));
}

/**
 * Implements hook_permission().
 */
function review_permission() {
  return array(
    'administer hcp review configuration' => array(
      'title' => t('Administer HCP: review integration'),
      'description' => t('Perform administration tasks within the review administrative functionality.'),
    ),
  );
}